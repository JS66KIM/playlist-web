<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>플레이리스트 만들기</title>
</head>
<body>
    <h1>새 플레이리스트 만들기</h1>

    <!-- 메인으로 돌아가는 링크 -->
    <p><a href="{{ url_for('index') }}">← 플레이리스트 목록으로 돌아가기</a></p>

    <!-- 곡 검색 폼 (GET) - 별도 폼 -->
    <h2>노래 검색</h2>
    <form method="GET" action="{{ url_for('create_playlist') }}">
        <input type="text" name="q" placeholder="제목/아티스트/앨범 검색"
               value="{{ search_query or '' }}">
        <button type="submit">검색</button>
    </form>

    <br>

    <!-- 플레이리스트 저장 폼 (POST) - 하나로 통합 -->
    <form method="POST" action="{{ url_for('create_playlist') }}">
        
        <h2>플레이리스트 정보</h2>
        <label>
            제목:
            <input type="text" name="title" required>
        </label>
        <br><br>

        <label>
            설명:
            <textarea name="description" rows="3" cols="40"></textarea>
        </label>
        <br><br>

        <hr>

        <h2>노래 선택</h2>

        {% if songs and songs|length > 0 %}
            <table border="1" cellpadding="5" style="width: 100%;">
                <thead>
                    <tr>
                        <th>선택</th>
                        <th>제목</th>
                        <th>아티스트</th>
                        <th>앨범</th>
                    </tr>
                </thead>
                <tbody>
                    {% for s in songs %}
                        <tr>
                            <td>
                                <!-- 체크박스로 곡 선택, value 는 song_id -->
                                <input type="checkbox" name="song_ids" value="{{ s['song_id'] }}">
                            </td>
                            <td>{{ s['title'] }}</td>
                            <td>{{ s['artist'] or '-' }}</td>
                            <td>{{ s['album'] or '-' }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>

            <br>
            <button type="submit">플레이리스트 저장</button>

        {% else %}
            <p>표시할 노래가 없습니다. 
               <a href="{{ url_for('manage_songs') }}">노래 관리 페이지</a>에서 노래를 추가하세요.
            </p>
        {% endif %}
    </form>

</body>
</html>