<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Playlist Web</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    /* ===== GLOBAL ===== */
    * { box-sizing: border-box; }
    body.app-body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: #121212;
      color: #e0e0e0;
      display: flex;
    }

    /* ===== SIDEBAR ===== */
    .sidebar {
      width: 220px;
      background-color: #1a1a1a;
      border-right: 1px solid #2a2a2a;
      height: 100vh;
      padding: 20px 16px;
      position: fixed;
      left: 0;
      top: 0;
    }
    .sidebar__username { font-size: 18px; font-weight: bold; margin-bottom: 24px; }
    .sidebar__menu { list-style: none; padding: 0; display: flex; flex-direction: column; gap: 14px; }
    .sidebar__menu a {
      text-decoration: none; color: #d0d0d0;
      padding: 8px; border-radius: 4px; display: block;
    }
    .sidebar__menu a:hover { background-color: #2b2b2b; color: #fff; }

    /* ===== MAIN PAGE ===== */
    .page {
      margin-left: 220px;
      width: 100%;
      padding: 24px 16px 40px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .page__title {
      text-align: center;
      font-size: 34px;
      letter-spacing: 2px;
      margin: 0 0 20px;
    }
    .hero {
      display: flex;
      justify-content: center;
      margin-top: auto;
      margin-bottom: auto;
    }

    /* ===== HERO (CARD CAROUSEL) ===== */
    :root {
      /* ê°„ê²© ì¡°ì ˆ */
      --hero-gap-near: 60%;
      --hero-gap-far: 120%;

      /* í¬ê¸°ê° */
      --hero-scale-center: 1;
      --hero-scale-near: 0.86;
      --hero-scale-far: 0.72;

      /* íë¦¼ ì •ë„ */
      --hero-blur-near: 0.9px;
      --hero-blur-far: 1.25px;

      /* ë°ê¸°(ì–´ë‘¡ê¸°) ê°’ */
      --hero-dim-center: 1;
      --hero-dim-near: 0.8;
      --hero-dim-far: 0.6;
    }

    /* HERO ì»¨í…Œì´ë„ˆ (ë°°ê²½ ë°•ìŠ¤ í¬ê²Œ, ì¹´ë“œê°€ íŠ€ì–´ë‚˜ì˜¤ì§€ ì•Šë„ë¡ hidden) */
    .hero__stage {
      width: min(1200px, 96vw);
      height: clamp(320px, 42vw, 520px);
      background:
        radial-gradient(circle at 20% 20%, rgb(255, 95, 42), transparent 60%),
        radial-gradient(circle at 20% 20%, rgba(126, 56, 255, 0.66), transparent 60%),
        linear-gradient(140deg, #1f1f21 0%, #32386a 50%, #240f43 90%);
      border: 1px solid #2a2a2a;
      border-radius: 28px;
      position: relative;
      overflow: hidden;
      padding: 28px 0;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* ì¤‘ì•™ì— ë³´ì´ëŠ” ì™¸ê³½ ë°•ìŠ¤ (ì˜µì…˜) */
    .hero__outline {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      width: min(680px, 72%);
      height: min(420px, 78%);
      border-radius: 24px;
      border: 1px dashed rgba(255,255,255,0.06);
      box-shadow: 0 2px 10px rgba(0,0,0,0.35) inset;
      pointer-events: none;
      z-index: 2; /* ì¹´ë“œë“¤ì´ ì´ ìœ„ì— ì˜¬ë¼ì˜¤ë„ë¡ ë‚®ì€ z-index */
    }

    /* .hero__railëŠ” ì¹´ë“œ ë°°ì¹˜ë¥¼ ë•ëŠ” ë ˆì´ì–´ (í„°ì¹˜/ì´ë²¤íŠ¸ëŠ” ì¹´ë“œë§Œ ë°›ìŒ) */
    .hero__rail {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      pointer-events: none;
    }

    /* ì¹´ë“œ: ì •ì‚¬ê° ë¹„ìœ¨(1:1) */
    .hero__card {
      position: absolute;
      width: clamp(220px, 28vw, 360px);
      aspect-ratio: 1 / 1;
      border-radius: 20px;
      overflow: hidden;
      box-shadow:
        0px 22px 44px rgba(0, 0, 0, 0.85),
        0px 10px 20px rgba(0,0,0,1);
      transition: transform 0.45s cubic-bezier(.2,.9,.2,1), filter 0.45s ease, z-index 0.2s ease;
      cursor: pointer;
      pointer-events: auto;
      top: 50%;
    }
    .hero__card img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      -webkit-backface-visibility: hidden;
      backface-visibility: hidden;
      transition: filter .25s ease;
    }

    /* ì œëª© ë¼ë²¨ (ê¸°ë³¸ ìˆ¨ê¹€) */
    .hero__card .hero__label {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%) scale(0.98);
      padding: 10px 14px;
      border-radius: 5px;
      background: rgba(0, 0, 0, 0.55);
      color: #fff;
      font-weight: 700;
      font-size: clamp(14px, 2.4vw, 18px);
      letter-spacing: .2px;
      text-align: center;
      max-width: 88%;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      opacity: 0;
      pointer-events: none;
      transition: opacity .25s ease, transform .25s ease, background .25s ease;
      backdrop-filter: blur(4px);
    }

    /* ì¤‘ì•™ ì¹´ë“œ */
    .pos-center {
      transform: translateX(0) translateY(-50%) scale(calc(var(--hero-scale-center) * 1.02));
      z-index: 6;
      filter: brightness(var(--hero-dim-center));
    }
    /* near ì¹´ë“œ (ì¢Œ/ìš° 1ì—´) */
    .pos-near-left,
    .pos-near-right {
      transform: translateX(var(--_nearX)) translateY(-50%) scale(var(--hero-scale-near));
      z-index: 5;
      filter: brightness(var(--hero-dim-near)) blur(var(--hero-blur-near));
    }
    /* far ì¹´ë“œ (ì¢Œ/ìš° 2ì—´) */
    .pos-far-left,
    .pos-far-right {
      transform: translateX(var(--_farX)) translateY(-50%) scale(var(--hero-scale-far));
      z-index: 4;
      filter: brightness(var(--hero-dim-far)) blur(var(--hero-blur-far));
    }
    /* Xì¶• ì´ë™ ê°’ */
    .pos-near-left  { --_nearX: calc(-1 * var(--hero-gap-near)); }
    .pos-near-right { --_nearX: var(--hero-gap-near); }
    .pos-far-left   { --_farX: calc(-1 * var(--hero-gap-far)); }
    .pos-far-right  { --_farX: var(--hero-gap-far); }

    /* ì¤‘ì•™ ì¹´ë“œ í˜¸ë²„ ì‹œ: ì´ë¯¸ì§€ ì–´ë‘¡ê²Œ + ë¼ë²¨ í‘œì‹œ */
    .hero__card.pos-center:hover img {
      filter: brightness(0.45) saturate(0.98) contrast(1.05);
    }
    .hero__card.pos-center:hover .hero__label {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1.02);
      background: rgba(0, 0, 0, 0.6);
    }

    /* HEROì™€ PLAYLIST ì‚¬ì´ ê³µê°„ */
    .hero-message {
      margin: 40px 0;
      text-align: center;
      font-size: 22px;
      font-weight: bold;
      color: #ff7f50;
      letter-spacing: 1px;
      font-family: 'Noto Sans KR', 'Arial', sans-serif;
    }

    /* ===== PLAYLIST LIST ===== */
    .playlist-list { list-style: none; padding: 0px; margin: 00px; }
    .playlist-list__item {
      background-color: #1e1e1e;
      border: 1px solid #2c2c2c;
      padding: 10px;
      border-radius: 6px;
      display: flex;
      gap: 12px;
      align-items: center;
      margin-bottom: 5px;
    }
    .playlist-list__thumb img {
      width: 60px; height: 60px; object-fit: cover; border-radius: 4px;
    }
    .playlist-list__title a { color: #fff; text-decoration: none; }
    .playlist-list__title a:hover { text-decoration: underline; }
    .empty-state {
      padding: 16px;
      background: #1e1e1e;
      border: 1px solid #2c2c2c;
      border-radius: 6px;
    }
    .playlist-list {
    max-width: 1500px;
    margin: 0 auto;
    padding: 0 12px;   /* í™”ë©´ ëì— ë”± ë¶™ëŠ” ê²ƒ ë°©ì§€ */
}

  </style>
</head>

<body class="app-body">
  <!-- SIDEBAR -->
  <aside class="sidebar">
    {% if session.get('user_id') %}
      <div class="sidebar__username">{{ session['username'] }} ë‹˜</div>
    {% else %}
      <div class="sidebar__username">Guest</div>
    {% endif %}

    <ul class="sidebar__menu">
      {% if session.get('user_id') %}
        <li><a href="{{ url_for('logout') }}">ë¡œê·¸ì•„ì›ƒ</a></li>
      {% else %}
        <li><a href="{{ url_for('login') }}">ë¡œê·¸ì¸</a></li>
      {% endif %}

      <li><a href="{{ url_for('index') }}">í”Œë ˆì´ë¦¬ìŠ¤íŠ¸</a></li>

      {% if session.get('user_id') %}
        <li><a href="{{ url_for('create_playlist') }}">+ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ì¶”ê°€</a></li>
      {% endif %}

      {% if session.get('is_admin') %}
        <li><a href="{{ url_for('manage_songs') }}">ğŸ› ë…¸ë˜ ê´€ë¦¬</a></li>
      {% endif %}
    </ul>
  </aside>

  <!-- MAIN -->
  <div class="page">
    <h1 class="page__title">PLAYLIST CARTI</h1>

    <!-- HERO -->
    <section class="hero">
      <div class="hero__stage" id="heroStage"></div>
    </section>

    <!-- í•˜ë£¨ë§ˆë‹¤ ëœë¤ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ ë¬¸êµ¬ -->
    <div class="hero-message">
      ğŸµ DAILY RANDOM PLAYLIST ğŸµ
    </div>

    <!-- PLAYLIST LIST -->
    <main class="page__content">
      {% if playlists %}
        <ul class="playlist-list">
          {% for pl in playlists %}
          <li class="playlist-list__item">
            {% if pl["display_cover_url"] %}
              <div class="playlist-list__thumb">
                <img src="{{ pl['display_cover_url'] }}">
              </div>
            {% endif %}
            <div>
              <h2 class="playlist-list__title">
                <a href="{{ url_for('view_playlist', playlist_id=pl['playlist_id']) }}">
                  {{ pl["title"] or "ì œëª© ì—†ìŒ" }}
                </a>
              </h2>
            </div>
          </li>
          {% endfor %}
        </ul>
      {% else %}
        <div class="empty-state">ë“±ë¡ëœ í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
      {% endif %}
    </main>
  </div>

  <!-- PASS PLAYLIST DATA TO JS -->
  <script>
    const HERO_ITEMS = [
      {% for pl in playlists %}
      {
        id: {{ pl['playlist_id'] }},
        img: "{{ (pl['display_cover_url'] or '')|e }}",
        url: "{{ url_for('view_playlist', playlist_id=pl['playlist_id']) }}",
        title: "{{ (pl['title'] or 'ì œëª© ì—†ìŒ')|e }}"
      },
      {% endfor %}
    ];
    const HERO_PLACEHOLDER = "https://picsum.photos/600/600?random=1";
  </script>

  <!-- HERO JS -->
  <script>
  (function () {
    const stage = document.getElementById("heroStage");
    const rail  = document.createElement("div");
    rail.className = "hero__rail";
    stage.appendChild(rail);

    // ë°ì´í„° ì¤€ë¹„
    const raw = (HERO_ITEMS || []).map(it => ({
      ...it,
      img: it.img && it.img.trim() ? it.img : HERO_PLACEHOLDER
    }));
    if (raw.length === 0) return;

    // ëœë¤ ì„ê¸°
    function shuffle(a){
      for(let i=a.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));
        [a[i],a[j]]=[a[j],a[i]];
      }
      return a;
    }
    const items = shuffle([...raw]);

    // ìµœì†Œ 5ì¥ í™•ë³´ (ì›ë³¸ì„ ìˆœí™˜í•˜ë©° ì±„ì›€)
    while (items.length < 5) {
      items.push(raw[items.length % raw.length]);
    }

    // ì²˜ìŒì— ë³´ì—¬ì¤„ 5ì¥
    const visible = items.slice(0, 5);

    // ìœ„ì¹˜ í´ë˜ìŠ¤(ì‹œê°ì  ìˆœì„œ)
    const POS = ["pos-far-left","pos-near-left","pos-center","pos-near-right","pos-far-right"];

    // ì¹´ë“œ DOM ìƒì„±(ë‹¨ 5ê°œë§Œ ë§Œë“¤ê³  ê³„ì† ì¬ì‚¬ìš©)
    const cards = visible.map((data, i) => {
      const el = document.createElement("div");
      el.className = `hero__card ${POS[i]}`;
      el.dataset.id = data.id;
      el.dataset.url = data.url;

      const img = document.createElement("img");
      img.src = data.img;
      img.alt = "cover";
      el.appendChild(img);

      // ğŸ”¹ ì œëª© ë¼ë²¨ ì¶”ê°€ (hover ì‹œ ì¤‘ì•™ì— í‘œì‹œ)
      const label = document.createElement("div");
      label.className = "hero__label";
      label.textContent = (data.title || "ì œëª© ì—†ìŒ").trim();
      el.appendChild(label);

      el.addEventListener("click", () => {
        const idx = cards.indexOf(el);

        if (POS[idx] === "pos-center") {
          // ì¤‘ì•™ë§Œ í˜ì´ì§€ ì´ë™
          if (data.url) window.location.href = data.url;
          return;
        }

        // ì¢Œ/ìš° í´ë¦­ ì‹œ: í•´ë‹¹ ì¹´ë“œê°€ ì¤‘ì•™(index 2)ìœ¼ë¡œ ì˜¤ë„ë¡ í´ë˜ìŠ¤ë§Œ ì¬ë°°ì¹˜
        slideToCenter(idx);
      });

      rail.appendChild(el);
      return el;
    });

    // í˜„ì¬ í™”ë©´ì— ë³´ì´ëŠ” ë°ì´í„° ë°°ì—´(ì¹´ë“œ ë…¸ë“œì™€ 1:1)
    let state = [...visible];

    // idxì˜ ì¹´ë“œë¥¼ ì¤‘ì•™(2)ë¡œ ìŠ¬ë¼ì´ë“œ: í´ë˜ìŠ¤ë§Œ íšŒì „ â†’ transitionìœ¼ë¡œ ë¶€ë“œëŸ½ê²Œ ì´ë™
    function slideToCenter(idx) {
      while (idx !== 2) {
        if (idx < 2) {
          // ì™¼ìª½ í´ë¦­ â†’ ì˜¤ë¥¸ìª½ìœ¼ë¡œ í•œ ì¹¸ ë°€ê¸°
          state.unshift(state.pop());
          cards.unshift(cards.pop());
          idx++;
        } else {
          // ì˜¤ë¥¸ìª½ í´ë¦­ â†’ ì™¼ìª½ìœ¼ë¡œ í•œ ì¹¸ ë°€ê¸°
          state.push(state.shift());
          cards.push(cards.shift());
          idx--;
        }
      }
      // íšŒì „ëœ cards ë°°ì—´ì˜ ê° ìš”ì†Œì— ìƒˆ ìœ„ì¹˜ í´ë˜ìŠ¤ ë¶€ì—¬
      cards.forEach((el, i) => {
        el.classList.remove("pos-far-left","pos-near-left","pos-center","pos-near-right","pos-far-right");
        el.classList.add(POS[i]);
      });
    }
  })();
  </script>
</body>
</html>
